@using FoodOrderApp.Models
@inject IHttpClientFactory HttpClientFactory
@inject TeamsUserCredential teamsUserCredential
<h3>Zamowienia</h3>
<button @onclick="ReLoadOrders">Odśwież</button>
@if(orders == null)
{
    <p>Ładowanie</p>
}else if(orders.Count == 0)
{
    <p>Brak zamówień</p>
}
else
{
    <FluentAccordion>
    @foreach(OrderModel order in orders)
    {
        <FluentAccordionItem Heading="@order.Id.ToString()">
            <p>Zamawiający: @order.Orderer</p>
            <p>Restauracja: @order.RestaurantName</p>
            <p>Minimalna wartość zamówienia: @order.MinCost</p>
            <p>Aktualna wartość zamówienia: @order.CurrentCost</p>
            @if (order.MinCost - order.CurrentCost > 0)
            {
                <p>Aby można było zamówić brakuje: @(order.MinCost - order.CurrentCost)</p>
            }
            @if (order.MinCostForFreeDelivery != null)
            {
                if (order.MinCostForFreeDelivery - order.CurrentCost > 0)
                {
                    <p>Opłata za dowóz: @order.DeliveryFee</p>
                    <p>Do darmowej dostawy brakuje: @(order.MinCostForFreeDelivery - order.CurrentCost)</p>
                }
                else
                {
                    <p>Dostawa jest darmowa</p>     
                }
            }
            <p>Numer telefonu zamawiającego: @order.PhoneNumber</p>
            <OrderPositions orderId="@order.Id" userId="@userId" Parent="@this"/>
        </FluentAccordionItem>
    }
    </FluentAccordion>
}

@code {
    [Parameter]
    public string? userId { get; set; }
    private List<OrderModel> orders;
    protected override async Task OnInitializedAsync()
    {
        await LoadOrders();

    }
    private async Task LoadOrders()
    {
        var httpClient = HttpClientFactory.CreateClient("FoodOrderApi");
        orders = await httpClient.GetFromJsonAsync<List<OrderModel>>("api/OrderModels");

    }
    public async Task ReLoadOrders()
    {
        await LoadOrders();
    }
    private async Task GetUser()
    {
        
    }
}
